%YAML 1.1
---
options:
 tick : 10000
 multiple: 1
blocks :
 - i-87017 :
    name : slot2
    setpoints:
     slot: 2
 - i-87040 :
    name : slot6
    setpoints:
     slot: 6
 - i-87015 :
    name : slot7
    setpoints:
     slot: 7

 - const :
    name : high pressure
    setpoint : 12500
 - const :
    name : run
    setpoint : 1

 - last state:
    name : prev
    multiple: 1
    strings:
     key:
      - ice starting

 - linear:
    name: CBP1
    input: slot2.ai0
    setpoints:
     in high: 20000
     in low: 4000
     out high: 13000
     out low: 0

 - linear:
    name: CHP1
    input: slot2.ai1
    setpoints:
     in high: 20000
     in low: 4000
     out high: 31000
     out low: 0

 - linear:
    name: CBPI1
    input: slot2.ai2
    setpoints:
     in high: 20000
     in low: 4000
     out high: 13000
     out low: 0

 - linear:
    name: CBP2
    input: slot2.ai3
    setpoints:
     in high: 20000
     in low: 4000
     out high: 13000
     out low: 0

 - linear:
    name: CHP2
    input: slot2.ai4
    setpoints:
     in high: 20000
     in low: 4000
     out high: 31000
     out low: 0

 - linear:
    name: CBPI2
    input: slot2.ai5
    setpoints:
     in high: 20000
     in low: 4000
     out high: 13000
     out low: 0

 - r404a :
    name : Te1
    input : CBPI1
 - r404a :
    name : Te2
    input : CBPI2

 - pt1000 :
    name : Tw
    input : slot7.ai0
 - pt1000 :
    name : Tin
    input : slot7.ai1
 - pt1000 :
    name : T
    input : slot7.ai2
 - pt1000 :
    name : Tg1
    input : slot7.ai3
 - pt1000 :
    name : Tg2
    input : slot7.ai4
 - pt1000 :
    name : Tg3
    input : slot7.ai5
 - pt1000 :
    name : Tg4
    input : slot7.ai6

 - PD :
    name : G1 overheat
    inputs :
     feed : Tg1
     reference : Te1
 - PD :
    name : G2 overheat
    inputs :
     feed : Tg2
     reference : Te1
 - PD :
    name : G3 overheat
    inputs :
     feed : Tg3
     reference : Te2
 - PD :
    name : G4 overheat
    inputs :
     feed : Tg4
     reference : Te2

 - linear:
    name: Vg1
    input: G1 overheat.error
    setpoints:
     in high: 40
     in low: 20
     out high: 8000
     out low: 0
 - linear:
    name: Vg2
    input: G2 overheat.error
    setpoints:
     in high: 40
     in low: 20
     out high: 8000
     out low: 0
 - linear:
    name: Vg3
    input: G3 overheat.error
    setpoints:
     in high: 40
     in low: 20
     out high: 8000
     out low: 0
 - linear:
    name: Vg4
    input: G4 overheat.error
    setpoints:
     in high: 40
     in low: 20
     out high: 8000
     out low: 0

 - linear:
    name: V1
    input: T
    setpoints:
     in high: 100
     in low: 0
     out high: 8000
     out low: 4000
 - linear:
    name: V2
    input: T
    setpoints:
     in high: 200
     in low: 100
     out high: 8000
     out low: 0
 - linear:
    name: V3
    input: T
    setpoints:
     in high: 100
     in low: 0
     out high: 8000
     out low: 4000
 - linear:
    name: V4
    input: T
    setpoints:
     in high: 200
     in low: 100
     out high: 8000
     out low: 0

 - PD :
    name : CHP1_error
    inputs :
     feed : CHP1
     reference : high pressure
 - fuzzy if z:
    name : CHP1 is very cold
    input : CHP1_error.error
    setpoints:              {         b: -500, c: -250 }
 - fuzzy then d:
    name : CHP1 is very cold then V12c is BN
    input : CHP1 is very cold
    setpoints:                                       { a:  -700, b: -350, c: 0 }
 - fuzzy if d:
    name : CHP1 is cold
    input : CHP1_error.error
    setpoints:              { a: -500, b: -250, c: 0 }
 - fuzzy then d:
    name : CHP1 is cold then V12c is N
    input : CHP1 is cold
    setpoints:                                       { a:   -60, b:   -30, c: 0 }
 - fuzzy if d:
    name : CHP1 is normal
    input : CHP1_error.error
    setpoints:              { a: -250, b:   0, c: 250 }
 - fuzzy then d:
    name : CHP1 is normal V12c is Z
    input : CHP1 is normal
    setpoints:                                       { a:  -40, b:     0, c:  40 }
 - fuzzy if d:
    name : CHP1 is hot
    input : CHP1_error.error
    setpoints:              { a: 0, b:  250, c: 500 }
 - fuzzy then d:
    name : CHP1 is hot then V12c is P
    input : CHP1 is hot
    setpoints:                                       { a: 0, b: 30, c: 60 }
 - fuzzy if s:
    name : CHP1 is very hot
    input : CHP1_error.error
    setpoints:              { a: 250, b: 500        }
 - fuzzy then d:
    name : CHP1 is very hot then V12c is BP
    input : CHP1 is very hot
    setpoints:                                       { a: 0, b: 350, c: 700 }

 - fuzzy if z:
    name : CHP1D is BN
    input : CHP1_error.diff
    setpoints:              {         b: -500, c: -250 }
 - fuzzy then d:
    name : CHP1D is BN then V12c is BN
    input : CHP1D is BN
    setpoints:                                       { a: 0, b: 350, c: 700 }
 - fuzzy if d:
    name : CHP1D is SN
    input : CHP1_error.diff
    setpoints:              { a: -500, b: -350, c: -200 }
 - fuzzy then d:
    name : CHP1D is SN then V12c is N
    input : CHP1D is SN
    setpoints:                                       { a: -80, b: -40, c: 0 }
 - fuzzy if d:
    name : CHP1D is SP
    input : CHP1_error.diff
    setpoints:              { a: 200, b: 350, c: 500 }
 - fuzzy then d:
    name : CHP1D is SP then V12c is P
    input : CHP1D is SP
    setpoints:                                       { a: 0, b: 40, c: 80 }
 - fuzzy if s:
    name : CHP1D is BP
    input : CHP1_error.diff
    setpoints:              { a: 250, b: 500         }
 - fuzzy then d:
    name : CHP1D is BP then V12c is BP
    input : CHP1D is BP
    setpoints:                                       { a: 0, b: 350, c: 700 }

 - weighted sum :
    name : V12 correction
    inputs:
     value :
      - CHP1 is very cold then V12c is BN.value
      - CHP1 is cold then V12c is N.value
      - CHP1 is normal V12c is Z.value
      - CHP1 is hot then V12c is P.value
      - CHP1 is very hot then V12c is BP.value
      - CHP1D is BN then V12c is BN.value
      - CHP1D is SN then V12c is N.value
      - CHP1D is SP then V12c is P.value
      - CHP1D is BP then V12c is BP.value

 - analog valve:
    name: V12
    inputs:
     input: V12 correction
    setpoints:
     high: 8000
     low: 0

 - PD :
    name : CHP2_error
    inputs :
     feed : CHP2
     reference : high pressure
 - fuzzy if z:
    name : CHP2 is very cold
    input : CHP2_error.error
    setpoints:              {         b: -500, c: -250 }
 - fuzzy then d:
    name : CHP2 is very cold then V34c is BN
    input : CHP2 is very cold
    setpoints:                                       { a:  -700, b: -350, c: 0 }
 - fuzzy if d:
    name : CHP2 is cold
    input : CHP2_error.error
    setpoints:              { a: -500, b: -250, c: 0 }
 - fuzzy then d:
    name : CHP2 is cold then V34c is N
    input : CHP2 is cold
    setpoints:                                       { a:   -60, b:   -30, c: 0 }
 - fuzzy if d:
    name : CHP2 is normal
    input : CHP2_error.error
    setpoints:              { a: -250, b:   0, c: 250 }
 - fuzzy then d:
    name : CHP2 is normal V34c is Z
    input : CHP2 is normal
    setpoints:                                       { a:  -40, b:     0, c:  40 }
 - fuzzy if d:
    name : CHP2 is hot
    input : CHP2_error.error
    setpoints:              { a: 0, b:  250, c: 500 }
 - fuzzy then d:
    name : CHP2 is hot then V34c is P
    input : CHP2 is hot
    setpoints:                                       { a: 0, b: 30, c: 60 }
 - fuzzy if s:
    name : CHP2 is very hot
    input : CHP2_error.error
    setpoints:              { a: 250, b: 500        }
 - fuzzy then d:
    name : CHP2 is very hot then V34c is BP
    input : CHP2 is very hot
    setpoints:                                       { a: 0, b: 350, c: 700 }

 - fuzzy if z:
    name : CHP2D is BN
    input : CHP2_error.diff
    setpoints:              {         b: -500, c: -250 }
 - fuzzy then d:
    name : CHP2D is BN then V34c is BN
    input : CHP2D is BN
    setpoints:                                       { a: 0, b: 350, c: 700 }
 - fuzzy if d:
    name : CHP2D is SN
    input : CHP2_error.diff
    setpoints:              { a: -500, b: -350, c: -200 }
 - fuzzy then d:
    name : CHP2D is SN then V34c is N
    input : CHP2D is SN
    setpoints:                                       { a: -80, b: -40, c: 0 }
 - fuzzy if d:
    name : CHP2D is SP
    input : CHP2_error.diff
    setpoints:              { a: 200, b: 350, c: 500 }
 - fuzzy then d:
    name : CHP2D is SP then V34c is P
    input : CHP2D is SP
    setpoints:                                       { a: 0, b: 40, c: 80 }
 - fuzzy if s:
    name : CHP2D is BP
    input : CHP2_error.diff
    setpoints:              { a: 250, b: 500         }
 - fuzzy then d:
    name : CHP2D is BP then V34c is BP
    input : CHP2D is BP
    setpoints:                                       { a: 0, b: 350, c: 700 }

 - weighted sum :
    name : V34 correction
    inputs:
     value :
      - CHP2 is very cold then V34c is BN.value
      - CHP2 is cold then V34c is N.value
      - CHP2 is normal V34c is Z.value
      - CHP2 is hot then V34c is P.value
      - CHP2 is very hot then V34c is BP.value
      - CHP2D is BN then V34c is BN.value
      - CHP2D is SN then V34c is N.value
      - CHP2D is SP then V34c is P.value
      - CHP2D is BP then V34c is BP.value

 - analog valve:
    name: V34
    inputs:
     input: V34 correction
    setpoints:
     high: 8000
     low: 0

 - timer:
    multiple: 1
    name: ice start expire
    input: prev.ice starting
    setpoints:
     delay: 2

 - cascade:
    name: ice starting
    multiple: 1
    setpoints:
     output count: 1
     stage interval: 9
    inputs:
     stage: run
     unstage: ice start expire
     stop: ice start expire

 - copy:
    name: ice starting copy
    multiple: 1
    inputs:
     source: ice starting.1
     target: prev.ice starting

 - logical OR:
    name: ice overflow run
    multiple: 1
    inputs:
     input: slot6.di4
     input: ice starting.1

 - i-8041 :
    setpoints:
     slot: 1
    inputs:
     1: ice overflow run
 - i-8024 :
    setpoints:
     slot: 3
    inputs:
     0: V1
     1: V2
     2: Vg1
     3: V12
 - i-8024 :
    setpoints:
     slot: 4
    inputs:
     0: Vg2
     1: V3
     2: Vg3
     3: V34
 - i-8024 :
    setpoints:
     slot: 5
    inputs:
     0: Vg4
     1: V4

 - log :
    inputs :
     ice : slot6.di4
     CBP1 : CBP1
     CHP1 : CHP1
     CBPI1 : CBPI1
     Te1 : Te1
     CBP2 : CBP2
     CHP2 : CHP2
     CBPI2 : CBPI2
     Te2 : Te2
     Tw : Tw
     Tin : Tin
     T : T
     Tg1 : Tg1
     G1 : G1 overheat.error
     Tg2 : Tg2
     G2 : G2 overheat.error
     Tg3 : Tg3
     G3 : G3 overheat.error
     Tg4 : Tg4
     G4 : G4 overheat.error
     V12 : V12
     V1 : V1
     V2 : V2
     V34 : V34
     V3 : V3
     V4 : V4
