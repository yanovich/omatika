%YAML 1.1
---
options:
 tick : 100
 multiple: 100
blocks :
 - i-8042 :
    name : slot1
    multiple: 1
    setpoints:
     slot: 1
 - i-87015 :
    name : slot3
    setpoints:
     slot: 3
 - i-87017 :
    name : slot4
    multiple: 10
    setpoints:
     slot: 4
 - ni1000tk5000 :
    name : T21
    input : slot3.ai3
 - const :
    name : hot water
    setpoint : 570
 - PD :
    name : T21_error
    inputs :
     feed : T21
     reference : hot water
 - fuzzy if z:
    name : T21 is very cold
    input : T21_error.error
    setpoints:              {         b: -70, c: -30 }
 - fuzzy then d:
    name : T21 is very cold then V21 is VBP
    input : T21 is very cold
    setpoints:                                       { a:  9500, b: 10000, c: 10500 }
 - fuzzy if d:
    name : T21 is cold
    input : T21_error.error
    setpoints:              { a: -50, b: -30, c: -10 }
 - fuzzy then d:
    name : T21 is cold then V21 is BP
    input : T21 is cold
    setpoints:                                       { a:   100, b:   400, c:   700 }
 - fuzzy if d:
    name : T21 is cool
    input : T21_error.error
    setpoints:              { a: -30, b: -10, c:   0 }
 - fuzzy then d:
    name : T21 is cool then V21 is SP
    input : T21 is cool
    setpoints:                                       { a:     0, b:   100, c:   200 }
 - fuzzy if d:
    name : T21 is normal
    input : T21_error.error
    setpoints:              { a: -10, b:   0, c:  30 }
 - fuzzy then d:
    name : T21 is normal V21 is Z
    input : T21 is normal
    setpoints:                                       { a:  -300, b:     0, c:   300 }
 - fuzzy if d:
    name : T21 is warm
    input : T21_error.error
    setpoints:              { a:   0, b:  30, c:  80 }
 - fuzzy then d:
    name : T21 is warm then V21 is SN
    input : T21 is warm
    setpoints:                                       { a:  -200, b:  -100, c:     0 }
 - fuzzy if d:
    name : T21 is hot
    input : T21_error.error
    setpoints:              { a:  30, b:  80, c: 180 }
 - fuzzy then d:
    name : T21 is hot then V21 is BN
    input : T21 is hot
    setpoints:                                       { a:  -700, b:  -400, c:  -100 }
 - fuzzy if s:
    name : T21 is very hot
    input : T21_error.error
    setpoints:              { a:  80, b: 180         }
 - fuzzy then d:
    name : T21 is very hot then V21 is VBN
    input : T21 is very hot
    setpoints:                                       { a: -10500, b: -10000, c: -9500 }

 - fuzzy if z:
    name : T21D is BN
    input : T21_error.diff
    setpoints:              {         b: -50, c: -10 }
 - fuzzy then d:
    name : T21D is BN then V21 is VBP
    input : T21D is BN
    setpoints:                                       { a:  9500, b: 10000, c: 10500 }
 - fuzzy if d:
    name : T21D is SN
    input : T21_error.diff
    setpoints:              { a: -30, b: -10, c:  -1 }
 - fuzzy then d:
    name : T21D is SN then V21 is BP
    input : T21D is SN
    setpoints:                                       { a:   100, b:   400, c:   700 }
 - fuzzy if d:
    name : T21D is SP
    input : T21_error.diff
    setpoints:              { a:   1, b:  10, c:  30 }
 - fuzzy then d:
    name : T21D is SP then V21 is BN
    input : T21D is SP
    setpoints:                                       { a:  -700, b:  -400, c:  -100 }
 - fuzzy if s:
    name : T21D is BP
    input : T21_error.diff
    setpoints:              { a:  10, b:  50         }
 - fuzzy then d:
    name : T21D is BP then V21 is VBN
    input : T21D is BP
    setpoints:                                       { a: -10500, b: -10000, c: -9500 }

 - weighted sum :
    name : V21 correction
    inputs:
     value : T21 is very cold then V21 is VBP.value
     value : T21 is cold then V21 is BP.value
     value : T21 is cool then V21 is SP.value
     value : T21 is normal V21 is Z.value
     value : T21 is warm then V21 is SN.value
     value : T21 is hot then V21 is BN.value
     value : T21 is very hot then V21 is VBN.value
     value : T21D is BN then V21 is VBP.value
     value : T21D is SN then V21 is BP.value
     value : T21D is SP then V21 is BN.value
     value : T21D is BP then V21 is VBN.value

 - discrete valve:
    name: V21
    multiple: 1
    input: V21 correction
    setpoints:
     span: 47000
     input multiple: 100

 - ni1000tk5000 :
    name : T11
    input : slot3.ai0
 - ni1000tk5000 :
    name : T12
    input : slot3.ai1
 - ni1000tk5000 :
    name : T
    input : slot3.ai4
 - central heating :
    name : heating
    inputs :
     flowback: T12
     street: T
    setpoints :
     feed: 950
     flowback: 700
     street: -280
     inside: 230
     stop: 120

 - PD :
    name : T11_error
    inputs :
     feed : T11
     reference : heating
 - fuzzy if z:
    name : T11 is very cold
    input : T11_error.error
    setpoints:              {         b: -70, c: -30 }
 - fuzzy then d:
    name : T11 is very cold then V11 is VBP
    input : T11 is very cold
    setpoints:                                       { a:  9500, b: 10000, c: 10500 }
 - fuzzy if d:
    name : T11 is cold
    input : T11_error.error
    setpoints:              { a: -50, b: -30, c: -10 }
 - fuzzy then d:
    name : T11 is cold then V11 is BP
    input : T11 is cold
    setpoints:                                       { a:   100, b:   400, c:   700 }
 - fuzzy if d:
    name : T11 is cool
    input : T11_error.error
    setpoints:              { a: -30, b: -10, c:   0 }
 - fuzzy then d:
    name : T11 is cool then V11 is SP
    input : T11 is cool
    setpoints:                                       { a:     0, b:   100, c:   200 }
 - fuzzy if d:
    name : T11 is normal
    input : T11_error.error
    setpoints:              { a: -10, b:   0, c:  30 }
 - fuzzy then d:
    name : T11 is normal V11 is Z
    input : T11 is normal
    setpoints:                                       { a:  -300, b:     0, c:   300 }
 - fuzzy if d:
    name : T11 is warm
    input : T11_error.error
    setpoints:              { a:   0, b:  30, c:  80 }
 - fuzzy then d:
    name : T11 is warm then V11 is SN
    input : T11 is warm
    setpoints:                                       { a:  -200, b:  -100, c:     0 }
 - fuzzy if d:
    name : T11 is hot
    input : T11_error.error
    setpoints:              { a:  30, b:  80, c: 180 }
 - fuzzy then d:
    name : T11 is hot then V11 is BN
    input : T11 is hot
    setpoints:                                       { a:  -700, b:  -400, c:  -100 }
 - fuzzy if s:
    name : T11 is very hot
    input : T11_error.error
    setpoints:              { a:  80, b: 180         }
 - fuzzy then d:
    name : T11 is very hot then V11 is VBN
    input : T11 is very hot
    setpoints:                                       { a: -10500, b: -10000, c: -9500 }

 - fuzzy if z:
    name : T11D is BN
    input : T11_error.diff
    setpoints:              {         b: -50, c: -10 }
 - fuzzy then d:
    name : T11D is BN then V11 is VBP
    input : T11D is BN
    setpoints:                                       { a:  9500, b: 10000, c: 10500 }
 - fuzzy if d:
    name : T11D is SN
    input : T11_error.diff
    setpoints:              { a: -30, b: -10, c:  -1 }
 - fuzzy then d:
    name : T11D is SN then V11 is BP
    input : T11D is SN
    setpoints:                                       { a:   100, b:   400, c:   700 }
 - fuzzy if d:
    name : T11D is SP
    input : T11_error.diff
    setpoints:              { a:   1, b:  10, c:  30 }
 - fuzzy then d:
    name : T11D is SP then V11 is BN
    input : T11D is SP
    setpoints:                                       { a:  -700, b:  -400, c:  -100 }
 - fuzzy if s:
    name : T11D is BP
    input : T11_error.diff
    setpoints:              { a:  10, b:  50         }
 - fuzzy then d:
    name : T11D is BP then V11 is VBN
    input : T11D is BP
    setpoints:                                       { a: -10500, b: -10000, c: -9500 }

 - weighted sum :
    name : V11 correction
    inputs:
     value : T11 is very cold then V11 is VBP.value
     value : T11 is cold then V11 is BP.value
     value : T11 is cool then V11 is SP.value
     value : T11 is normal V11 is Z.value
     value : T11 is warm then V11 is SN.value
     value : T11 is hot then V11 is BN.value
     value : T11 is very hot then V11 is VBN.value
     value : T11D is BN then V11 is VBP.value
     value : T11D is SN then V11 is BP.value
     value : T11D is SP then V11 is BN.value
     value : T11D is BP then V11 is VBN.value

 - discrete valve:
    name: V11
    multiple: 1
    input: V11 correction
    setpoints:
     span: 47000
     input multiple: 100

 - trigger:
    name: T trigger
    setpoints:
     high: 160
     low: 140
     hysteresis: 1
    input: T

 - logical NOT:
    name: auto
    multiple: 1
    input: slot1.di6

 - logical AND:
    name: M hot water
    multiple: 1
    input: auto

 - logical AND:
    multiple: 1
    name: M ventilation
    inputs:
     input: auto
     input: T trigger.low

 - linear:
    name: heating pressure input
    multiple: 10
    input: slot4.ai0
    setpoints:
     in high: 20000
     in low: 4000
     out high: 1600
     out low: 0

 - linear:
    name: heating pressure output
    multiple: 10
    input: slot4.ai1
    setpoints:
     in high: 20000
     in low: 4000
     out high: 1600
     out low: 0

 - PD :
    name : heating pressure difference
    multiple: 10
    inputs :
     feed : heating pressure output
     reference : heating pressure input

 - trigger:
    name: heating pressure
    multiple: 10
    input: heating pressure difference.error
    setpoints:
     high: 90
     low: 40

 - logical NOT:
    multiple: 1
    name: M heating stop
    input: M ventilation

 - cascade:
    name: M heating
    multiple: 1
    setpoints:
     output count: 2
     stage interval: 6000
     unstage interval: 6000
    inputs:
     stage: heating pressure.low
     unstage: heating pressure.high
     stop: M heating stop

 - i-8042 out :
    name : slot1.out
    multiple: 1
    setpoints:
     slot: 1
    inputs:
     status: slot1.do0
     2: M hot water
     3: M ventilation
     4: V11.close
     5: V11.open
     6: V21.open
     7: V21.close

 - log :
    inputs :
     T : T
     T11 : T11
     T12 : T12
     T21 : T21
     T21E : T21_error.error
     T21D : T21_error.diff
     V21 : V21 correction
     V21P : V21.position
